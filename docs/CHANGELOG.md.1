2025-10-26T16:37:45Z Implemented Web UI REST API (Tasks 5.4.1 & 5.4.2): Created docs/WEB_UI_API_SPECIFICATION.md defining 8 REST endpoints (GET /api/config/schema for parameter metadata with widget hints, GET /api/config with subsystem filter, POST /api/config/{subsystem}/{param} for parameter updates, POST /api/config/save for NVS persistence, plus existing WiFi/status endpoints). Extended HttpServer with ParameterRegistry integration: added HandleGetSchema/HandleGetConfig/HandlePostParameter/HandlePostSave handlers, implemented SendError/GetQueryParam helpers, updated ApplicationController to pass param_registry to HttpServer::Initialize(). API supports auto-generated Web UI from parameter metadata (number_input/slider/dropdown/checkbox/text_input widgets), type-safe validation via Parameter::Execute(), conditional visibility (e.g., keying.window_open only when preset==MANUAL), and password masking. Binary: 1001KB (4% free, +28KB from 973KB due to new handlers/JSON generation). Build: SUCCESS with warnings (uart_config_t initializers only).
2025-10-26T16:09:57Z Fixed HTTP 431 error: Increased CONFIG_HTTPD_MAX_REQ_HDR_LEN from 512 to 1024 bytes in sdkconfig.defaults to accommodate modern browser headers (User-Agent, Accept-*, cookies). Server now handles requests from Chrome, Firefox, and other browsers without "Request Header Fields Too Large" errors. Binary: 973KB (5% free, unchanged - config-only change).
2025-10-25T23:55:00Z WiFi secrets persistence and LED animation integration (Task 5.4.0.8, 1.7): Implemented Storage::ApplyWiFiSecretsIfEmpty() to populate NVS from wifi_secrets.h on first boot (SSID/password from #define macros → NVS if empty). WiFiConfig struct uses #ifdef defaults for seamless development workflow. Connected WiFiSubsystem to DiagnosticsSubsystem (forward declaration + diagnostics_ pointer) to trigger blue LED progressive animation on IP_EVENT_STA_GOT_IP (SignalWifiConnected call in EventHandler). Fixed USB dual CDC enumeration: Added CONFIG_TINYUSB_CDC_COUNT=2 and CONFIG_ESP_CONSOLE_USB_SERIAL_JTAG=n to sdkconfig.defaults (prevents Serial JTAG conflict). Binary: 959KB (6% free, -15KB vs previous 974KB due to config optimization). Build: SUCCESS.
2025-10-25T19:00:00Z Eliminated entire interactive console system: Deleted components/cmd_handler/ (23 commands) and components/usb_console/ (TUI, console CDC). Removed console initialization from ApplicationController. Added espressif__esp_tinyusb dependency to app component CMakeLists.txt for usb_early_init.cpp. Preserved usb_early_init.cpp for dual CDC (CDC0=debug logs, CDC1=empty). Binary: 393KB (63% free, saved ~21KB from previous 414KB with console commands). Main loop simplified. Resource savings: ~1500 lines code, ~21KB flash.
2025-10-25T13:39:45Z Fixed TUI incomplete rendering: TUI displayed only upper half of screen due to USB CDC buffer size mismatch. Render buffer is 4KB but CDC TX buffer is 512 bytes (CONFIG_TINYUSB_CDC_TX_BUFSIZE). Modified SendRaw() to write in 256-byte chunks with 2ms delays between chunks, added retry logic on buffer full, added error logging. TUI now displays complete interface and responds to input correctly.
2025-10-25T00:09:00Z Fixed TUI deadlock by removing redundant tud_task() call: tinyusb_driver_install() already creates dedicated TinyUSB task, calling tud_task() again from main thread caused deadlock in Poll(). Removed tud_task() call, cleaned up UART debug code, removed test banners. TUI now renders correctly on CDC1 without corruption. Binary: 396KB (62% free). COMMITTED (git commit 7453e22).
2025-10-24T15:00:00Z Updated CONSOLE.md with TUI design specification: Added bordered ASCII art interface layout with status bar (callsign/uptime/WPM/freq), scrollable output area with ANSI colors, dedicated input area with label, command history (up/down arrows), auto-refresh on connection/command/navigation, VT100/ANSI compatibility for Linux/macOS/Windows terminals. Document version 1.1.
2025-10-24T14:35:00Z Cleaned up debug code and re-enabled diagnostics subsystem: Removed all esp_rom_printf statements and vTaskDelay debug delays from ApplicationController initialization sequence. Re-enabled DiagnosticsSubsystem initialization (was temporarily disabled for stability testing). Code now production-ready. Binary: 394KB (62% free).
2025-10-24T14:30:00Z Upgraded to esp_tinyusb 2.x API (2.0.1): Migrated tinyusb_config_t structure (port/phy/task/descriptor), updated CDC config (removed usb_dev/rx_unread_buf_sz), changed function names (tinyusb_cdcacm_initialized), updated callback event type check. Fixed watchdog warning by handling ESP_ERR_INVALID_STATE gracefully (already initialized by CONFIG_ESP_TASK_WDT_INIT=y). System verified stable on hardware. Binary: 374KB.
2025-10-24T13:20:01Z Fixed TinyUSB dual CDC bootloop: Configured MODE_DMA (not MODE_SLAVE), enabled watchdog (INT_WDT + TASK_WDT_INIT=y), aligned sdkconfig with working tmp/ project. Implemented log redirection via esp_log_set_vprintf hook and heartbeat task for CDC monitoring. USB Serial JTAG + TinyUSB coexist (COM7=service, COM8=debug logs). System stable, no bootloop. Binary: 369KB.
2025-10-23T21:15:00Z Completed Tasks 9.7 & 9.8: Eliminated code duplication in ApplyPresetDefaults (86→17 lines, 80% reduction) via constexpr lookup table (PresetConfigData struct + std::array<10>). Documented all timing constants: kPaddleEventQueueCapacity=32 (worst-case ISR burst at 80 WPM), audio task delays (10ms idle/5ms error for codec responsiveness), main loop 20ms (50Hz for LED animation + paddle latency + watchdog coordination). Binary: 385KB. Tests: 27/27 pass.
2025-10-23T20:40:00Z Completed Tasks 9.3 & 9.4: Implemented RAII resource wrappers (I2cBusHandle, I2sChannelHandle, IoExpanderHandle) for automatic cleanup, refactored SidetoneService::Deinitialize() from 60 lines to 25 lines with deterministic scope-based release. Added task watchdog monitoring (500ms timeout) with esp_task_wdt_reset() in main loop, documented watchdog strategy in DEVELOPMENT.md (panic handler, coredump capture, recovery procedures). Binary size: 385KB (54% free). All tests pass (27/27).
2025-10-23T20:13:47Z Separated sidetone runtime (tone generator, codec driver, service) into audio_subsystem component, pruned circular dependencies, and restored idf.py build.
  Link error: undefined references to audio_subsystem::AudioSubsystem symbols when component depended on main; resolved by relocating sidetone code into audio_subsystem.
  Link error: undefined references to cmd_handler::ConsoleCommandHandler after refactor; resolved by updating cmd_handler CMake to depend on audio_subsystem instead of main.
2025-10-23T19:15:00Z Completed Task 9.5 subsystem refactoring: Decomposed monolithic ApplicationController (468 lines) into functional subsystems - KeyingSubsystem (paddle events/engine/timeline, ~150 lines), AudioSubsystem (sidetone, ~60 lines), DiagnosticsSubsystem (status LED/activity, ~80 lines). ApplicationController reduced to 327 lines (30% reduction) as thin orchestrator. Architecture documented with rationale for separation (testability, reusability, maintainability). Build verification pending.
2025-10-23T18:12:06Z Completed Task 9.5.1-9.5.4: Refactored main.cpp from 1148 lines to 51 lines (96% reduction) by extracting ConsoleCommandHandler (components/console/) and ApplicationController (components/app/) with dependency injection. All global state encapsulated, initialization sequence formalized, main loop delegated.
2025-10-21T11:59:57Z Initialized ESP32-S3 ESP-IDF project skeleton.
2025-10-21T16:19:39Z Authored Keyer QRS2HST PRD with architecture, testing, and milestone plan.
2025-10-21T16:22:54Z Refined PRD remote persona and clarified event-chain protocol and latency handling.
2025-10-21T16:26:08Z Generated task breakdown for Keyer QRS2HST including proposed modules and testing strategy.
2025-10-21T18:37:49Z Propagated PRD updates into task plan covering USB console, LED indicators, and high-speed CW targets.
2025-10-21T18:49:27Z Implemented hardware timing foundation (Paddle HAL, timeline buffer, NVS config skeleton) and added host tests.
2025-10-21T18:58:58Z Documented board GPIO map (paddles, NeoPixel, I2C/I2S) and updated 1.7 LED task requirements.
2025-10-21T19:28:14Z Added TinyUSB CDC console scaffold, NeoPixel status LED controller, and pinned devcontainer to ESP-IDF 5.4.1.
  Build on current ESP-IDF `latest` image fails (missing hal/aes_types.h in mbedTLS); rerun after container upgrade.
2025-10-21T20:05:00Z Renamed project HAL component to keyer_hal and cast config log fields to restore ESP-IDF build.
2025-10-21T20:25:00Z Refactored firmware to C-like C++ subset (no STL) and updated style guidance; build verified.
2025-10-21T20:32:00Z Enabled serial flashing from devcontainer by binding /dev/ttyUSB0 in devcontainer.json.
2025-10-21T20:45:00Z Mounted persistent VS Code storage and symlinked extension data via postStart script in devcontainer, covering extensions, user data, machine cache, and OpenAI config.
2025-10-21T20:53:27Z Stabilized devcontainer Codex persistence by running as root and symlinking storage into workspace .persistenza.
2025-10-21T20:57:58Z Forced devcontainer run as UID 0 to satisfy VS Code .postStart markers while keeping Codex persistence mount.
2025-10-21T21:03:56Z Rebuilt devcontainer user model: added vscode user, bind-mounted VS Code/OpenAI data into workspace, removed postStart symlinks to simplify Codex persistence.
2025-10-21T21:10:17Z Reworked devcontainer: added vscode user image defaults, pre-created VS Code/OpenAI dirs, and bound persistence mounts to fix startup permission errors.
2025-10-21T21:40:29Z Added host-side test harness with ESP-IDF stubs covering HAL, LED controller, storage, and refreshed run_tests.sh pipeline.
2025-10-21T21:48:16Z Translated remaining Italian notes and synced PRD/task list with expanded iambic timing requirements.
2025-10-21T21:51:43Z Reprioritized roadmap to focus on audio subsystem (new Task 2.0) so sidetone testing can proceed ahead of paddle engine work.
2025-10-22T07:22:45Z Persistent devcontainer mount directories are ensured via initializeCommand.
2025-10-22T07:34:11Z Reset workspace ownership to match devcontainer user and removed stale build tree to restore ninja configuration.
2025-10-22T07:54:25Z Resolved sidetone codec init build failures and confirmed host tests pass under run_tests.sh.
2025-10-22T08:10:13Z Pinned sidetone to ES8311 over I2S/I2C and refreshed sdkconfig.defaults plus developer docs.
2025-10-22T08:31:49Z Refactored sidetone audio into an ESP codec driver with double-buffered DMA writes and updated docs.
2025-10-22T08:49:15Z Added host stubs and unit tests covering injected codec driver and audio pump; verified run_tests.sh + idf.py build.
2025-10-22T12:35:37Z Added tone generator host test covering 3x144ms bursts with 44ms gaps, 650Hz tone, fades, and reran tests/build.
2025-10-22T14:26:52Z Swapped sine to LUT-based generator with ADSR attack/release and verified host tests + firmware build.
2025-10-22T14:41:37Z Hooked sidetone settings into NVS + USB console commands (volume/freq/fade/start-stop/save/load) and refreshed docs/tasks.
2025-10-22T21:15:00Z Enabled WS2812 status LED hardware driver via espressif/led_strip dependency and updated development notes.
2025-10-22T21:45:00Z Fixed ES8311 I2C address handling (shift to 8-bit bus value) so codec init succeeds on hardware.
2025-10-22T21:47:00Z Aligned host LED strip stub with new driver API and forced stub usage in tests so ./run_tests.sh passes with WS2812 support.
2025-10-22T21:48:30Z Synced DEVELOPMENT.md iambic preset table with PRD (Super Keyer, Accukeyer, Curtis “A”, memory variants, generic aperture).
2025-10-22T22:47:00Z Added late-release handling (forget vs consider) to paddle engine, updated docs, and extended host tests.
2025-10-22T23:05:00Z Implemented keying presets (V0–V9 + manual), mapped legacy behaviours, expanded NVS config, and added host tests for state-latch/memory disables.
2025-10-22T23:11:00Z Added sidetone verification harness script (WAV dump + simple analyzer) and documented usage (Task 2.5).
2025-10-22T23:15:00Z Added USB console `keying` commands (status, preset, window, memory, late-release, latch) with live engine reload and NVS persistence.
2025-10-22T22:10:00Z Added paddle engine with memory window defaults, NVS-backed keying config, and host tests covering squeeze and hold behaviour.
2025-10-23T09:12:30Z Hardened devcontainer user creation to reuse existing UID/GID so builds succeed when group 1000 already exists.
2025-10-23T09:28:45Z Renamed pre-existing UID 1000 user/home to vscode during devcontainer build to prevent useradd UID collisions.
2025-10-23T10:07:53Z Fixed IRAM linker error "dangerous relocation: l32r: literal placed after use" in EventLogger::push() by moving timeline logging from ISR (RecordPaddleEvent) to task context (DrainDeferredPaddleEvents) and adding thread-safe push()/push_isr() methods with spinlock protection. Build now succeeds after ESP-IDF update for TinyUSB support.
2025-10-23T10:15:19Z Enabled TinyUSB CDC console by updating ConsoleCdc API to match esp_tinyusb v1.x (new tinyusb_config_t structure with port/phy/task/descriptor fields), renamed components/usb to components/usb_console to avoid conflict with ESP-IDF core USB PHY driver, and added usb component dependency. TinyUSB now initializes successfully. Build OK, binary 0x77b10 bytes (53% free).
2025-10-23T10:17:04Z Fixed TinyUSB task config validation error by changing xCoreID from tskNO_AFFINITY to 0 (pin to core 0). esp_tinyusb validates xCoreID <= SOC_CPU_CORES_NUM (2 for ESP32-S3), and tskNO_AFFINITY (-1) fails this check. USB task now runs on core 0 alongside USB ISR.
2025-10-25T20:43:12Z Expanded parameter metadata system with general (callsign) and WiFi registry entries and captured deferred console integration tasks in docs/console_parameter_metadata_todo.md.
2025-10-25T21:12:46Z Enabled host test coverage builds (CMake HOST_TEST_COVERAGE option + run_tests.sh --coverage) and extended NVS stubs with string/u32 helpers so coverage builds succeed.
2025-10-25T22:03:05Z Added parameter metadata host tests covering StringParameter masking/validation and WiFi registry flows; linked config/parameter_registry.cpp into host harness and stubbed ESP_LOGD.
2025-10-25T23:00:00Z Added WiFi subsystem and HTTP server for Web UI configuration (Task 5.4.0.6-5.4.0.8): Created components/ui/ with HTTP server exposing REST API (/api/config/wifi, /api/status) and embedded HTML form for WiFi credentials. Integrated WiFiSubsystem and HttpServer in ApplicationController (WiFi::Tick in main loop at 50Hz, HTTP server started when WiFi ready). Updated sdkconfig.defaults with WiFi stack, TCP/IP, and HTTP server configuration. Added wifi_secrets.h.example template (gitignored). Binary: 974KB (+580KB for WiFi/TCP/HTTP stack, 7% free). Build: SUCCESS.
2025-10-25T23:15:00Z Refactored LED driver from keyer_hal to diagnostics_subsystem (architectural fix): Moved status_led.* from keyer_hal/ to diagnostics_subsystem/ as led_driver.* (pure WS2812 HAL). Keyer_hal now contains ONLY paddle + clock abstraction. Diagnostics_subsystem owns all LED application logic (frame buffer, paddle visualization, WiFi animation, word gap detection). Added SignalWifiConnected() method for blue progressive animation (3 cycles). Cleaned up CMakeLists dependencies. Binary: 974KB (unchanged - pure refactoring). Build: SUCCESS.
2025-10-25T23:20:00Z Fixed paddle LED mapping per user specification: LED 0-1 = DASH (dah paddle), LED 5-6 = DIT, LED 3 = word gap indicator (green/red center LED). Replaced dynamic "half LED" calculation with fixed positions. Added graceful degradation for <7 LED configurations. Binary: 974KB. Build: SUCCESS.
